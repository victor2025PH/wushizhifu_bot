# 智能群组审核系统部署说明

## ✅ 已完成的功能

### 一、核心功能
1. ✅ **问题回答自动审核系统**
   - 新成员加入时自动发送验证问题
   - 支持选择题、填空题、判断题、数学题
   - 支持多次尝试（可配置）
   - 支持超时处理

2. ✅ **添加群组功能**
   - `/addgroup <group_id> [title]` 命令
   - 验证群组ID格式和机器人权限
   - 自动创建审核配置

3. ✅ **群组列表功能**
   - 显示所有已管理群组
   - 显示群组统计信息（成员数、待审核数）
   - 支持查看详情

4. ✅ **批量审核功能**
   - 一键通过所有待审核成员
   - 一键拒绝所有待审核成员
   - 显示处理结果

### 二、数据库更新
- ✅ 新增 `verification_questions` 表（问题库）
- ✅ 新增 `verification_records` 表（审核记录）
- ✅ 新增 `verification_configs` 表（审核配置）
- ✅ 扩展 `group_repository` 方法

### 三、服务层
- ✅ `VerificationRepository` - 审核数据操作
- ✅ `VerificationService` - 审核业务逻辑

## 📋 部署步骤

### 1. 拉取最新代码
```bash
cd /home/ubuntu/wushizhifu/bot
git pull origin main
```

### 2. 数据库自动迁移
数据库表会在 bot 启动时自动创建，无需手动操作。

### 3. 重启服务
```bash
sudo systemctl restart wushizhifu-bot
```

### 4. 查看日志
```bash
sudo journalctl -u wushizhifu-bot -f
```

## 🎯 使用说明

### 添加群组
1. 将机器人添加到群组
2. 赋予机器人管理员权限
3. 在管理员面板中点击"群组设置" → "添加群组"
4. 使用命令：`/addgroup -1001234567890 群组名称`

### 启用审核
1. 添加群组后，系统自动创建默认审核配置
2. 在群组设置中配置审核规则
3. 启用审核：需要时修改群组配置（后续版本将提供界面）

### 测试自动审核
1. 启用审核后，新成员加入群组
2. 机器人自动发送验证问题到私聊（或群组）
3. 用户回答问题
4. 答对自动通过，答错可重试，超时或被拒绝

### 管理审核
1. 在管理员面板点击"群组审核"
2. 查看待审核成员列表
3. 点击"全部通过"或"全部拒绝"批量处理

## 📊 默认问题

系统已预置以下默认问题：
1. "伍拾支付的主要功能是什么？"（答案：支付/转账/USDT/数字资产）
2. "USDT是什么？"（答案：USDT/泰达币/稳定币）
3. "本群是否允许发送广告？"（答案：否/不允许/禁止/不）
4. "请回答：3+5=？"（答案：8/八）

## ⚙️ 配置说明

### 审核模式
- `question` - 问题回答审核（默认）
- `manual` - 手动审核（未来）
- `hybrid` - 混合审核（未来）

### 问题配置
- 允许尝试次数：默认 3 次
- 回答时限：默认 5 分钟（300秒）
- 难度级别：easy, medium, hard

## 🔍 验证部署

部署后请验证：
1. ✅ 数据库表是否创建成功（查看日志）
2. ✅ 添加群组功能是否正常
3. ✅ 群组列表是否正常显示
4. ✅ 新成员加入时是否收到验证问题
5. ✅ 回答问题后是否自动通过审核
6. ✅ 批量审核功能是否正常

## 📝 注意事项

1. **权限要求**：机器人必须是群组管理员才能正常工作
2. **私聊发送**：验证问题会尝试发送到用户私聊，如果失败会在群组中发送
3. **超时处理**：用户超过时限未回答会被自动拒绝
4. **多次尝试**：答错可以在限制次数内重试

## 🐛 故障排查

### 问题：新成员没有收到验证问题
- 检查群组是否已添加到管理系统
- 检查审核是否已启用
- 检查机器人是否有管理员权限
- 查看日志确认是否有错误

### 问题：回答问题没有反应
- 检查是否在正确的群组中回答
- 检查答案是否正确
- 检查是否超过时限
- 查看日志确认处理情况

### 问题：批量审核失败
- 检查是否有待审核成员
- 查看日志确认错误信息

## 📚 相关文档

- `智能群组审核系统优化方案.md` - 完整设计方案
- `群组管理功能开发与优化方案.md` - 功能开发方案

