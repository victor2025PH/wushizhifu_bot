# 部署最新代码到服务器

## 当前状态

从日志可以看到 Bot 已经成功重启，但可能还没有部署最新的代码（包括 `/help` 命令和修复的 URL）。

## 部署步骤

### 1. 确认本地代码已提交到 GitHub

在本地（Windows）执行：

```bash
cd D:\wushizhifu\wushizhifu-bot

# 查看更改状态
git status

# 如果有没有提交的文件，先提交
git add .
git commit -m "添加 /help 命令处理器，修复 MiniApp URL，删除顶部边框，改为简体中文"

# 推送到 GitHub
git push origin main
```

### 2. 在服务器上拉取最新代码

在服务器上执行：

```bash
cd /home/ubuntu/wushizhifu/bot

# 拉取最新代码
git pull origin main

# 查看最新提交
git log -1 --oneline

# 确认文件已更新
ls -lh handlers/user_handlers.py
ls -lh keyboards/main_kb.py
ls -lh utils/bot_setup.py
ls -lh services/message_service.py
```

### 3. 重启 Bot 服务

```bash
# 重启服务以应用更改
sudo systemctl restart wushizhifu-bot

# 等待几秒
sleep 3

# 查看启动日志
sudo journalctl -u wushizhifu-bot -n 50 --no-pager
```

### 4. 验证功能

成功启动后，日志应该显示：

```
✅ Database initialized
✅ Bot commands set successfully
✅ Menu button set: '打开应用' -> https://50zf.usdt2026.cc?view=dashboard
✅ Bot description set successfully
🤖 Bot: @wushi68_bot (伍拾支付)
✅ WuShiPay System Initialized Successfully
```

## 快速检查脚本

如果已经上传了 `检查启动状态.sh`，可以运行：

```bash
cd /home/ubuntu/wushizhifu/bot
chmod +x 检查启动状态.sh
./检查启动状态.sh
```

## 验证功能列表

部署后，请验证以下功能：

1. **/help 命令**：
   - 在 Telegram 中发送 `/help`
   - 应该收到使用指南

2. **菜单按钮**：
   - 打开 Bot 个人资料页面
   - 应该看到「打开应用」按钮
   - 点击后应该打开 MiniApp

3. **启动收银台按钮**：
   - 点击主键盘的「💎 启动伍拾收银台」按钮
   - 应该正确打开 MiniApp dashboard

4. **欢迎消息**：
   - 发送 `/start` 命令
   - 应该看到没有顶部边框的简体中文欢迎消息

