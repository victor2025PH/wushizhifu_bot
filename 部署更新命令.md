# éƒ¨ç½²æ›´æ–°å‘½ä»¤

## ğŸ“‹ å¿«é€Ÿæ›´æ–°éƒ¨ç½²æ­¥éª¤

### æ–¹æ³• 1: é€šè¿‡ Git æ›´æ–°ï¼ˆæ¨èï¼‰

```bash
# 1. è¿›å…¥ Bot ç›®å½•
cd /home/ubuntu/wushizhifu/bot
# æˆ–
cd /opt/wushizhifu/bot

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 3. å®‰è£…/æ›´æ–°ä¾èµ–
source venv/bin/activate
pip install -r requirements.txt

# 4. é‡å¯ Bot æœåŠ¡
sudo systemctl restart wushizhifu-bot

# 5. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status wushizhifu-bot

# 6. æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u wushizhifu-bot -f
```

### æ–¹æ³• 2: æ‰‹åŠ¨ä¸Šä¼ æ›´æ–°

å¦‚æœæ‚¨æ²¡æœ‰ä½¿ç”¨ Gitï¼Œå¯ä»¥æ‰‹åŠ¨ä¸Šä¼ æ›´æ–°çš„æ–‡ä»¶ï¼š

```bash
# 1. å¤‡ä»½å½“å‰ä»£ç 
cd /home/ubuntu/wushizhifu/bot
cp -r . ../bot_backup_$(date +%Y%m%d_%H%M%S)

# 2. ä¸Šä¼ æ–°æ–‡ä»¶ï¼ˆä½¿ç”¨ WinSCP æˆ– SCPï¼‰
# éœ€è¦æ›´æ–°çš„æ–‡ä»¶ï¼š
# - bot.py
# - keyboards/main_kb.py
# - handlers/user_handlers.py
# - utils/bot_setup.py (æ–°æ–‡ä»¶)
# - services/ai_service.py (å¦‚æœæ›´æ–°äº†)
# - requirements.txt

# 3. å®‰è£…/æ›´æ–°ä¾èµ–
source venv/bin/activate
pip install -r requirements.txt

# 4. é‡å¯ Bot æœåŠ¡
sudo systemctl restart wushizhifu-bot

# 5. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤
sudo journalctl -u wushizhifu-bot -n 50
```

## ğŸ”§ éœ€è¦æ›´æ–°çš„æ–‡ä»¶åˆ—è¡¨

æ ¸å¿ƒæ–‡ä»¶ï¼š
- `bot.py` - Bot å¯åŠ¨æ–‡ä»¶ï¼Œæ·»åŠ äº† Menu Button è®¾ç½®
- `keyboards/main_kb.py` - ä¸»é”®ç›˜ï¼Œä¿®å¤äº† Config å¯¼å…¥
- `handlers/user_handlers.py` - ç”¨æˆ·å¤„ç†å™¨ï¼Œæ·»åŠ äº† /help å‘½ä»¤
- `utils/bot_setup.py` - **æ–°æ–‡ä»¶**ï¼ŒBot è®¾ç½®å·¥å…·
- `services/ai_service.py` - AI æœåŠ¡ï¼ˆå¦‚æœæ”¯æŒ OpenAI/Geminiï¼‰
- `requirements.txt` - ä¾èµ–åˆ—è¡¨ï¼ˆå¯èƒ½éœ€è¦æ›´æ–°ï¼‰

## âš™ï¸ é…ç½®æ£€æŸ¥

æ›´æ–°åï¼Œç¡®ä¿ `.env` æ–‡ä»¶é…ç½®æ­£ç¡®ï¼š

```bash
# æ£€æŸ¥ .env æ–‡ä»¶
cat .env

# åº”è¯¥åŒ…å«ï¼š
# BOT_TOKEN=your_token
# OPENAI_API_KEY=your_key (å¯é€‰)
# GEMINI_API_KEY=your_key (å¯é€‰)
```

## ğŸ” éªŒè¯æ›´æ–°

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
sudo systemctl status wushizhifu-bot
```

åº”è¯¥æ˜¾ç¤º `active (running)`

### 2. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

```bash
sudo journalctl -u wushizhifu-bot -n 100 --no-pager
```

åº”è¯¥çœ‹åˆ°ï¼š
- âœ… Database initialized
- âœ… Menu button set: 'æ‰“å¼€åº”ç”¨' -> https://50zf.usdt2026.cc
- âœ… Bot commands set successfully

### 3. æµ‹è¯•åŠŸèƒ½

åœ¨ Telegram ä¸­ï¼š
1. æ‰“å¼€ Bot çš„ä¸ªäººèµ„æ–™é¡µé¢ï¼Œåº”è¯¥çœ‹åˆ°ã€Œæ‰“å¼€åº”ç”¨ã€æŒ‰é’®
2. ç‚¹å‡»ã€Œæ‰“å¼€åº”ç”¨ã€æŒ‰é’®ï¼Œåº”è¯¥æ‰“å¼€ MiniApp
3. åœ¨èŠå¤©ä¸­ç‚¹å‡»ã€ŒğŸ’ å¯åŠ¨ä¼æ‹¾æ”¶é“¶å°ã€æŒ‰é’®ï¼Œåº”è¯¥æ‰“å¼€ MiniApp
4. å‘é€ `/start` å’Œ `/help` å‘½ä»¤ï¼Œåº”è¯¥æ­£å¸¸å“åº”

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: Menu Button æœªæ˜¾ç¤º

```bash
# æ£€æŸ¥æ—¥å¿—
sudo journalctl -u wushizhifu-bot | grep -i "menu"

# å¦‚æœçœ‹åˆ°é”™è¯¯ï¼Œå¯èƒ½æ˜¯æƒé™é—®é¢˜æˆ– API é™åˆ¶
# å°è¯•æ‰‹åŠ¨è®¾ç½®ï¼ˆé€šè¿‡ Bot APIï¼‰
```

### é—®é¢˜ 2: MiniApp æ‰“å¼€é”™è¯¯

```bash
# æ£€æŸ¥ MiniApp URL æ˜¯å¦æ­£ç¡®
grep MINIAPP_URL config.py

# åº”è¯¥æ˜¾ç¤ºï¼šMINIAPP_URL: str = "https://50zf.usdt2026.cc"

# æ£€æŸ¥å‰ç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œ
curl -I https://50zf.usdt2026.cc
```

### é—®é¢˜ 3: æŒ‰é’®æœªæ›´æ–°

```bash
# ç¡®ä¿é‡å¯äº†æœåŠ¡
sudo systemctl restart wushizhifu-bot

# æ¸…é™¤ Telegram ç¼“å­˜ï¼ˆåœ¨å®¢æˆ·ç«¯ï¼‰
# iOS: é•¿æŒ‰ Botï¼Œé€‰æ‹© "Clear Cache"
# Android: é‡æ–°æ‰“å¼€å¯¹è¯
```

### é—®é¢˜ 4: ä¾èµ–å®‰è£…å¤±è´¥

```bash
# æ›´æ–° pip
pip install --upgrade pip

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt --force-reinstall

# å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œæ£€æŸ¥ Python ç‰ˆæœ¬
python3 --version  # åº”è¯¥æ˜¯ 3.10+
```

## ğŸ“ å®Œæ•´éƒ¨ç½²è„šæœ¬

åˆ›å»ºä¸´æ—¶éƒ¨ç½²è„šæœ¬ `update_bot.sh`ï¼š

```bash
#!/bin/bash
set -e

echo "ğŸš€ å¼€å§‹æ›´æ–° Bot..."

# è¿›å…¥ç›®å½•
cd /home/ubuntu/wushizhifu/bot || cd /opt/wushizhifu/bot

# å¤‡ä»½
echo "ğŸ“¦ å¤‡ä»½å½“å‰ç‰ˆæœ¬..."
cp -r . ../bot_backup_$(date +%Y%m%d_%H%M%S) 2>/dev/null || true

# æ‹‰å–æ›´æ–°ï¼ˆå¦‚æœä½¿ç”¨ Gitï¼‰
if [ -d .git ]; then
    echo "ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ..."
    git pull origin main
else
    echo "âš ï¸  æœªæ£€æµ‹åˆ° Gitï¼Œè¯·æ‰‹åŠ¨ä¸Šä¼ æ–‡ä»¶"
    exit 1
fi

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
pip install -r requirements.txt

# é‡å¯æœåŠ¡
echo "ğŸ”„ é‡å¯æœåŠ¡..."
sudo systemctl restart wushizhifu-bot

# ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 3

# æ£€æŸ¥çŠ¶æ€
echo "âœ… æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
sudo systemctl status wushizhifu-bot --no-pager -l

echo "âœ¨ æ›´æ–°å®Œæˆï¼"
echo "ğŸ“‹ æŸ¥çœ‹æ—¥å¿—: sudo journalctl -u wushizhifu-bot -f"
```

ä½¿ç”¨ï¼š

```bash
chmod +x update_bot.sh
./update_bot.sh
```

## ğŸ”„ å›æ»šæ–¹æ³•

å¦‚æœæ›´æ–°åå‡ºç°é—®é¢˜ï¼š

```bash
# 1. åœæ­¢æœåŠ¡
sudo systemctl stop wushizhifu-bot

# 2. æ¢å¤å¤‡ä»½
cd /home/ubuntu/wushizhifu
mv bot bot_broken
mv bot_backup_YYYYMMDD_HHMMSS bot

# 3. é‡å¯æœåŠ¡
sudo systemctl start wushizhifu-bot
```

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡æ—¥å¿—ï¼š`sudo journalctl -u wushizhifu-bot -f`
2. Bot é…ç½®æ–‡ä»¶ï¼š`config.py`
3. ç¯å¢ƒå˜é‡ï¼š`.env`
4. å‰ç«¯æœåŠ¡ï¼š`curl https://50zf.usdt2026.cc`

