# 修复 is_premium 错误并重启 Bot

## 问题

服务器日志显示错误：
```
TypeError: int() argument must be a string, a bytes-like object or a real number, not 'NoneType'
File "/home/ubuntu/wushizhifu/bot/database/user_repository.py", line 62, in create_or_update_user
int(is_premium)
```

这是因为 `is_premium` 可能是 `None`，但代码试图将其转换为整数。

## 修复

代码已更新，现在会正确处理 `None` 值。

## 部署步骤

### 1. 推送代码到 GitHub

```bash
cd D:\wushizhifu\wushizhifu-bot
git add database/user_repository.py services/user_service.py
git commit -m "修复 is_premium None 值错误"
git push origin main
```

### 2. 在服务器上更新并重启

```bash
# SSH 连接到服务器
ssh ubuntu@your-server-ip

# 进入 bot 目录
cd /home/ubuntu/wushizhifu/bot

# 拉取最新代码
git pull origin main

# 清除 Python 缓存
find . -name "*.pyc" -delete
find . -name "__pycache__" -type d -exec rm -r {} + 2>/dev/null || true

# 停止可能存在的其他 Bot 进程
sudo systemctl stop wushizhifu-bot
sudo pkill -f bot.py
sleep 2

# 重启服务
sudo systemctl start wushizhifu-bot

# 查看日志确认
sleep 3
sudo journalctl -u wushizhifu-bot -n 50 --no-pager
```

### 3. 验证修复

在 Telegram 中：
1. 发送 `/start` 命令
2. 应该收到欢迎消息（没有错误）
3. 检查日志，确认没有 `TypeError` 错误

## 注意事项

- 确保只有一个 Bot 实例在运行（避免 `TelegramConflictError`）
- 如果仍然看到冲突错误，执行：
  ```bash
  sudo pkill -9 -f bot.py
  sudo systemctl restart wushizhifu-bot
  ```

