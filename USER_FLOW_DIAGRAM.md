# WuShiPay Bot 用戶流程圖

## 📱 主要用戶流程

### 1. 支付流程（收款）

```
用戶啟動 Bot (/start)
    ↓
點擊「💳 支付寶通道」或「🍀 微信通道」
    ↓
選擇「💰 收款」
    ↓
輸入金額（或使用計算器計算）
    ↓
顯示費率計算結果
    ├─ 交易金額
    ├─ 手續費
    └─ 實際到賬金額
    ↓
確認創建訂單
    ↓
生成支付二維碼/連結
    ↓
訂單狀態實時更新
    ↓
支付成功 → 發送通知 → 保存交易記錄
```

### 2. 支付流程（付款）

```
用戶啟動 Bot (/start)
    ↓
點擊「💳 支付寶通道」或「🍀 微信通道」
    ↓
選擇「💸 付款」
    ↓
輸入金額（或使用計算器計算）
    ↓
顯示訂單詳情
    ↓
確認創建訂單
    ↓
生成付款二維碼
    ↓
掃碼支付
    ↓
支付成功 → 發送通知 → 保存交易記錄
```

### 3. 計算器使用流程

```
用戶啟動 Bot (/start)
    ↓
點擊「🧮 計算器」
    ↓
選擇計算類型
    ├─ 費率計算（手續費計算）
    ├─ 匯率轉換（USDT/CNY等）
    └─ 批量計算
    ↓
輸入參數
    ├─ 金額
    ├─ 支付通道
    └─ VIP 等級
    ↓
顯示計算結果
    ├─ 手續費
    ├─ 實際金額
    └─ 匯率換算
    ↓
[選項1] 直接創建訂單
[選項2] 修改參數重新計算
[選項3] 返回主頁
```

### 4. 交易記錄查詢流程

```
用戶啟動 Bot (/start)
    ↓
點擊「📜 交易記錄」
    ↓
顯示最近交易列表（分頁）
    ├─ 交易時間
    ├─ 金額
    ├─ 通道
    └─ 狀態
    ↓
[選項1] 點擊交易查看詳情
[選項2] 使用篩選功能
    ├─ 時間範圍
    ├─ 交易類型
    ├─ 支付通道
    └─ 狀態
    ↓
顯示篩選結果
    ↓
點擊交易 → 查看詳情
    ├─ 訂單號
    ├─ 完整信息
    ├─ 時間戳
    └─ 操作按鈕
```

### 5. 鍵盤交互流程

```
主鍵盤
├─ 💎 收銀台 → Web App（未來功能）
├─ 💳 支付寶 → 支付流程
├─ 🍀 微信 → 支付流程
├─ 📜 交易記錄 → 查詢流程
├─ 🧮 計算器 → 計算流程
├─ 📊 統計 → 統計分析（未來）
└─ ⚙️ 設置 → 用戶設置（未來）
```

---

## 🎯 詳細交互設計

### 場景 1: 快速收款

**目標**: 用戶想要快速收款 ¥1000

```
1. 用戶點擊「💳 支付寶通道」
   → Bot: 「請選擇支付類型：💰 收款 | 💸 付款」

2. 用戶點擊「💰 收款」
   → Bot: 「請輸入收款金額（¥1 - ¥500,000）」

3. 用戶輸入「1000」
   → Bot: 「📊 訂單詳情：
          交易金額：¥1,000.00
          手續費（0.6%）：¥6.00
          實際到賬：¥994.00
          [確認創建訂單] [使用計算器] [返回修改]」

4. 用戶點擊「確認創建訂單」
   → Bot: 「✅ 訂單已創建
          訂單號：WS2025012412345678
          [查看二維碼] [複製支付連結]」

5. 支付完成
   → Bot: 「✅ 支付成功！
          訂單號：WS2025012412345678
          金額：¥1,000.00 已到賬
          [查看詳情] [返回首頁]」
```

### 場景 2: 使用計算器

**目標**: 用戶想計算收款 ¥5000 的手續費

```
1. 用戶點擊「🧮 計算器」
   → Bot: 「🧮 費率計算器
          [💰 費率計算] [💱 匯率轉換]」

2. 用戶點擊「💰 費率計算」
   → Bot: 「請輸入交易金額：¥______
          支付通道：[支付寶 ▼]
          VIP 等級：[普通 ▼]
          [計算]」

3. 用戶輸入「5000」，選擇「支付寶」，點擊「計算」
   → Bot: 「📊 計算結果：
          交易金額：¥5,000.00
          費率：0.60%
          手續費：¥30.00
          實際到賬：¥4,970.00
          [使用此金額創建訂單] [重新計算]」

4. 用戶點擊「使用此金額創建訂單」
   → 進入支付流程（步驟2開始）
```

### 場景 3: 查詢交易記錄

**目標**: 用戶想查看今天的交易記錄

```
1. 用戶點擊「📜 交易記錄」
   → Bot: 「📜 交易記錄（共 5 筆）
          [全部] [收款] [付款] [今日] [本週] [本月]
          
          【2025-01-24 今日】
          ✅ 收款 ¥1,000.00 | 支付寶 | 15:30:25
          ✅ 付款 ¥500.00 | 微信 | 14:20:10
          ...
          
          [上一頁] [下一頁] [返回主頁]」

2. 用戶點擊「今日」
   → Bot: 「📜 今日交易（共 2 筆）
          ...（僅顯示今日交易）」

3. 用戶點擊第一筆交易
   → Bot: 「📋 訂單詳情
          訂單號：WS2025012412345678
          狀態：✅ 支付成功
          類型：收款
          通道：支付寶
          金額：¥1,000.00
          手續費：¥6.00
          實收金額：¥994.00
          創建時間：2025-01-24 15:30:25
          支付時間：2025-01-24 15:30:42
          [返回列表] [返回主頁]」
```

---

## 🔄 狀態流轉圖

### 訂單狀態流轉

```
[創建訂單]
    ↓
[待支付] (pending)
    ├─ → [支付成功] (paid) → [已完成]
    ├─ → [支付失敗] (failed)
    ├─ → [已取消] (cancelled)
    └─ → [已過期] (expired)
    
[支付成功] (paid)
    ├─ → [已完成] (completed)
    └─ → [已退款] (refunded)
```

### 用戶操作狀態

```
[主頁]
    ├─ → [支付流程]
    │      ├─ → [輸入金額]
    │      ├─ → [確認訂單]
    │      └─ → [查看訂單]
    │
    ├─ → [計算器]
    │      ├─ → [計算結果]
    │      └─ → [創建訂單]
    │
    └─ → [交易記錄]
           ├─ → [查看詳情]
           ├─ → [篩選查詢]
           └─ → [統計分析]
```

---

## 📊 數據流圖

```
用戶操作
    ↓
Bot 接收消息/回調
    ↓
Middleware（用戶追蹤）
    ↓
Handler（處理邏輯）
    ↓
Service（業務邏輯）
    ├─ → UserService（用戶數據）
    ├─ → TransactionService（交易數據）
    ├─ → MessageService（消息生成）
    └─ → CalculatorService（計算邏輯）
    ↓
Database（數據持久化）
    ├─ → users 表
    ├─ → transactions 表
    └─ → rate_configs 表
    ↓
返回結果給用戶
```

---

## ⚡ 響應時間目標

- **普通消息響應**: < 1 秒
- **計算器計算**: < 0.5 秒
- **交易記錄查詢**: < 2 秒（10 條記錄）
- **訂單創建**: < 3 秒（包含二維碼生成）
- **支付狀態查詢**: < 1 秒

---

## 🎨 界面元素設計規範

### 按鈕設計

- **主要操作**: 使用明確的文字和圖標
- **次要操作**: 使用文字按鈕
- **確認操作**: 使用醒目的樣式（如粗體）
- **取消操作**: 使用較淡的樣式

### 消息格式

- **標題**: 使用粗體和圖標
- **內容**: 清晰分組，使用分隔線
- **操作**: 底部提供操作按鈕
- **狀態**: 使用顏色圖標（✅ ❌ ⏳）

### 數值顯示

- **金額**: 使用貨幣符號和千分位
- **百分比**: 明確標註
- **時間**: 使用易讀的格式（2025-01-24 15:30:25）

